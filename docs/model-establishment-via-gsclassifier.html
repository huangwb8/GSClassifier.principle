<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Model establishment via GSClassifier | The Principle of R Package GSClassifier</title>
  <meta name="description" content="The Principle of GSClassifier" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Model establishment via GSClassifier | The Principle of R Package GSClassifier" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Principle of GSClassifier" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Model establishment via GSClassifier | The Principle of R Package GSClassifier" />
  
  <meta name="twitter:description" content="The Principle of GSClassifier" />
  

<meta name="author" content="Weibin Huang" />


<meta name="date" content="2022-09-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="quick-start.html"/>
<link rel="next" href="suggestions-for-gsclassifier-model-developers.html"/>
<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GSClassifier</a></li>

<li class="divider"></li>
<li><a href="index.html#welcome" id="toc-welcome">Welcome</a>
<ul>
<li><a href="index.html#about" id="toc-about">üí¶About</a></li>
<li><a href="index.html#license" id="toc-license">üíøLicense</a></li>
<li><a href="index.html#installation" id="toc-installation">üëçInstallation</a></li>
<li><a href="index.html#mirror" id="toc-mirror">üëÄ<span>Mirror</span></a></li>
<li><a href="index.html#change-log" id="toc-change-log">üìöChange log</a></li>
<li><a href="index.html#todo" id="toc-todo">üìÜTODO</a></li>
<li><a href="index.html#other-projects" id="toc-other-projects">üå¥Other Projects</a></li>
</ul></li>
<li><a href="the-principle-of-gsclassifier.html#the-principle-of-gsclassifier" id="toc-the-principle-of-gsclassifier"><span class="toc-section-number">1</span> The Principle of GSClassifier</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#packages" id="toc-packages"><span class="toc-section-number">1.1</span> Packages</a></li>
<li><a href="the-principle-of-gsclassifier.html#flowchart" id="toc-flowchart"><span class="toc-section-number">1.2</span> Flowchart</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#data-processing" id="toc-data-processing"><span class="toc-section-number">1.2.1</span> Data Processing</a></li>
<li><a href="the-principle-of-gsclassifier.html#model-establishment-and-validation" id="toc-model-establishment-and-validation"><span class="toc-section-number">1.2.2</span> Model Establishment and Validation</a></li>
<li><a href="the-principle-of-gsclassifier.html#model-application" id="toc-model-application"><span class="toc-section-number">1.2.3</span> Model Application</a></li>
</ul></li>
<li><a href="the-principle-of-gsclassifier.html#topicTSP" id="toc-topicTSP"><span class="toc-section-number">1.3</span> Top scoring pairs</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#tsp-intro" id="toc-tsp-intro"><span class="toc-section-number">1.3.1</span> Introduction</a></li>
<li><a href="the-principle-of-gsclassifier.html#simulated-dataset" id="toc-simulated-dataset"><span class="toc-section-number">1.3.2</span> Simulated Dataset</a></li>
<li><a href="the-principle-of-gsclassifier.html#binned-expression" id="toc-binned-expression"><span class="toc-section-number">1.3.3</span> Binned expression</a></li>
<li><a href="the-principle-of-gsclassifier.html#pair-difference" id="toc-pair-difference"><span class="toc-section-number">1.3.4</span> Pair difference</a></li>
<li><a href="the-principle-of-gsclassifier.html#set-difference" id="toc-set-difference"><span class="toc-section-number">1.3.5</span> Set difference</a></li>
</ul></li>
</ul></li>
<li><a href="discussion.html#discussion" id="toc-discussion"><span class="toc-section-number">2</span> Discussion</a>
<ul>
<li><a href="discussion.html#packages-1" id="toc-packages-1"><span class="toc-section-number">2.1</span> Packages</a></li>
<li><a href="discussion.html#missing-value-imputation-mvi" id="toc-missing-value-imputation-mvi"><span class="toc-section-number">2.2</span> Missing value imputation (MVI)</a></li>
<li><a href="discussion.html#batch-effect" id="toc-batch-effect"><span class="toc-section-number">2.3</span> Batch effect</a></li>
<li><a href="discussion.html#hyperparameters" id="toc-hyperparameters"><span class="toc-section-number">2.4</span> Hyperparameters</a>
<ul>
<li><a href="discussion.html#topicSubmodel" id="toc-topicSubmodel"><span class="toc-section-number">2.4.1</span> Number of SubModel</a></li>
</ul></li>
</ul></li>
<li><a href="quick-start.html#quick-start" id="toc-quick-start"><span class="toc-section-number">3</span> Quick start</a>
<ul>
<li><a href="quick-start.html#about-1" id="toc-about-1"><span class="toc-section-number">3.1</span> About</a></li>
<li><a href="quick-start.html#data" id="toc-data"><span class="toc-section-number">3.2</span> Data</a></li>
<li><a href="quick-start.html#pad" id="toc-pad"><span class="toc-section-number">3.3</span> PAD</a>
<ul>
<li><a href="quick-start.html#preparation-of-the-test-data" id="toc-preparation-of-the-test-data"><span class="toc-section-number">3.3.1</span> Preparation of the test data</a></li>
<li><a href="quick-start.html#unsupervised-clustering" id="toc-unsupervised-clustering"><span class="toc-section-number">3.3.2</span> Unsupervised clustering</a></li>
<li><a href="quick-start.html#of-note" id="toc-of-note"><span class="toc-section-number">3.3.3</span> Of note</a></li>
</ul></li>
<li><a href="quick-start.html#padi" id="toc-padi"><span class="toc-section-number">3.4</span> PADi</a>
<ul>
<li><a href="quick-start.html#preparation-of-the-test-data-1" id="toc-preparation-of-the-test-data-1"><span class="toc-section-number">3.4.1</span> Preparation of the test data</a></li>
<li><a href="quick-start.html#use-a-specific-function-called-padi" id="toc-use-a-specific-function-called-padi"><span class="toc-section-number">3.4.2</span> Use a specific function called <code>PADi</code></a></li>
<li><a href="quick-start.html#use-the-callensemble-function" id="toc-use-the-callensemble-function"><span class="toc-section-number">3.4.3</span> Use the <code>callEnsemble</code> function</a></li>
<li><a href="quick-start.html#parallel-strategy-for-padi" id="toc-parallel-strategy-for-padi"><span class="toc-section-number">3.4.4</span> Parallel strategy for PADi</a></li>
<li><a href="quick-start.html#single-sample-subtype-calling" id="toc-single-sample-subtype-calling"><span class="toc-section-number">3.4.5</span> Single sample subtype calling</a></li>
<li><a href="quick-start.html#of-note-1" id="toc-of-note-1"><span class="toc-section-number">3.4.6</span> Of note</a></li>
</ul></li>
<li><a href="quick-start.html#use-external-models-from-luckymodel-package" id="toc-use-external-models-from-luckymodel-package"><span class="toc-section-number">3.5</span> Use external models from luckyModel package</a></li>
<li><a href="quick-start.html#pancancer-immune-subtypes" id="toc-pancancer-immune-subtypes"><span class="toc-section-number">3.6</span> PanCancer immune subtypes</a></li>
</ul></li>
<li><a href="model-establishment-via-gsclassifier.html#model-establishment-via-gsclassifier" id="toc-model-establishment-via-gsclassifier"><span class="toc-section-number">4</span> Model establishment via GSClassifier</a>
<ul>
<li><a href="model-establishment-via-gsclassifier.html#about-2" id="toc-about-2"><span class="toc-section-number">4.1</span> About</a></li>
<li><a href="model-establishment-via-gsclassifier.html#data-preparation" id="toc-data-preparation"><span class="toc-section-number">4.2</span> Data preparation</a></li>
<li><a href="model-establishment-via-gsclassifier.html#fitting-models" id="toc-fitting-models"><span class="toc-section-number">4.3</span> Fitting models</a>
<ul>
<li><a href="model-establishment-via-gsclassifier.html#gsclassifier-model-training" id="toc-gsclassifier-model-training"><span class="toc-section-number">4.3.1</span> GSClassifier model training</a></li>
<li><a href="model-establishment-via-gsclassifier.html#scaller-for-the-best-call" id="toc-scaller-for-the-best-call"><span class="toc-section-number">4.3.2</span> Scaller for the best call</a></li>
<li><a href="model-establishment-via-gsclassifier.html#assemble-your-model" id="toc-assemble-your-model"><span class="toc-section-number">4.3.3</span> Assemble your model</a></li>
<li><a href="model-establishment-via-gsclassifier.html#of-note-2" id="toc-of-note-2"><span class="toc-section-number">4.3.4</span> Of note</a></li>
</ul></li>
<li><a href="model-establishment-via-gsclassifier.html#calling-subtypes" id="toc-calling-subtypes"><span class="toc-section-number">4.4</span> Calling subtypes</a></li>
</ul></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#suggestions-for-gsclassifier-model-developers" id="toc-suggestions-for-gsclassifier-model-developers"><span class="toc-section-number">5</span> Suggestions for GSClassifier model developers</a>
<ul>
<li><a href="suggestions-for-gsclassifier-model-developers.html#about-3" id="toc-about-3"><span class="toc-section-number">5.1</span> About</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#available-models" id="toc-available-models"><span class="toc-section-number">5.2</span> Available models</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#components-of-a-gsclassifier-model" id="toc-components-of-a-gsclassifier-model"><span class="toc-section-number">5.3</span> Components of a GSClassifier model</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#submit-models-to-luckymodel-package" id="toc-submit-models-to-luckymodel-package"><span class="toc-section-number">5.4</span> Submit models to luckyModel package</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#repeatablility-of-models" id="toc-repeatablility-of-models"><span class="toc-section-number">5.5</span> Repeatablility of models</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#gene-annotation" id="toc-gene-annotation"><span class="toc-section-number">5.6</span> Gene Annotation</a></li>
</ul></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li><a href="https://blognas.hwb0307.com/" target="blank">Welcome to My Blog!</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Principle of R Package GSClassifier</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-establishment-via-gsclassifier" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Model establishment via GSClassifier</h1>
<div id="about-2" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> About</h2>
<p>Sometimes, researchers might have their own gene signatures and know how many subtypes they want to call before (based on some knowledges). Gratifyingly, comprehensive functions were also provided in <code>GSClassifier</code>. In this section, we would show how to build a <code>GSClassifier</code> model like <code>PADi</code>.</p>
</div>
<div id="data-preparation" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Data preparation</h2>
<blockquote>
<p>Note: The test data is only for the demonstration of the modeling</p>
</blockquote>
<p>Load packages:</p>
<p>Load data:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="model-establishment-via-gsclassifier.html#cb64-1" aria-hidden="true" tabindex="-1"></a>testData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;testData.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;GSClassifier&quot;</span>))</span>
<span id="cb64-2"><a href="model-establishment-via-gsclassifier.html#cb64-2" aria-hidden="true" tabindex="-1"></a>expr <span class="ot">&lt;-</span> testData<span class="sc">$</span>PanSTAD_expr_part</span>
<span id="cb64-3"><a href="model-establishment-via-gsclassifier.html#cb64-3" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> testData<span class="sc">$</span>PanSTAD_phenotype_part</span></code></pre></div>
<p>Select training and testing cohorts across different platforms and <code>PAD subtypes</code> from <code>PAD</code> function:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="model-establishment-via-gsclassifier.html#cb65-1" aria-hidden="true" tabindex="-1"></a>modelInfo <span class="ot">&lt;-</span> <span class="fu">modelData</span>(</span>
<span id="cb65-2"><a href="model-establishment-via-gsclassifier.html#cb65-2" aria-hidden="true" tabindex="-1"></a>    design,</span>
<span id="cb65-3"><a href="model-establishment-via-gsclassifier.html#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id.col =</span> <span class="st">&quot;ID&quot;</span>,</span>
<span id="cb65-4"><a href="model-establishment-via-gsclassifier.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&quot;platform&quot;</span>, <span class="st">&quot;PAD_subtype&quot;</span>),</span>
<span id="cb65-5"><a href="model-establishment-via-gsclassifier.html#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prop =</span> <span class="fl">0.7</span>,</span>
<span id="cb65-6"><a href="model-establishment-via-gsclassifier.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">145</span></span>
<span id="cb65-7"><a href="model-establishment-via-gsclassifier.html#cb65-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Check the result <code>modelInfo</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="model-establishment-via-gsclassifier.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(modelInfo)</span>
<span id="cb66-2"><a href="model-establishment-via-gsclassifier.html#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="model-establishment-via-gsclassifier.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Train)</span>
<span id="cb66-4"><a href="model-establishment-via-gsclassifier.html#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="model-establishment-via-gsclassifier.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Valid)</span>
<span id="cb66-6"><a href="model-establishment-via-gsclassifier.html#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;Repeat&quot; &quot;Data&quot;  </span></span>
<span id="cb66-7"><a href="model-establishment-via-gsclassifier.html#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                    ID  Dataset PAD_subtype PIAM_subtype PIDG_subtype platform</span></span>
<span id="cb66-8"><a href="model-establishment-via-gsclassifier.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606509 GSM1606509 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-9"><a href="model-establishment-via-gsclassifier.html#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606517 GSM1606517 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-10"><a href="model-establishment-via-gsclassifier.html#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606503 GSM1606503 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-11"><a href="model-establishment-via-gsclassifier.html#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606525 GSM1606525 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-12"><a href="model-establishment-via-gsclassifier.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606511 GSM1606511 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-13"><a href="model-establishment-via-gsclassifier.html#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM1606527 GSM1606527 GSE65801       PAD-I         high         high GPL14550</span></span>
<span id="cb66-14"><a href="model-establishment-via-gsclassifier.html#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                    ID  Dataset PAD_subtype PIAM_subtype PIDG_subtype platform</span></span>
<span id="cb66-15"><a href="model-establishment-via-gsclassifier.html#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235558 GSM2235558 GSE84437       PAD-I         high         high  GPL6947</span></span>
<span id="cb66-16"><a href="model-establishment-via-gsclassifier.html#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235561 GSM2235561 GSE84437      PAD-II         high          low  GPL6947</span></span>
<span id="cb66-17"><a href="model-establishment-via-gsclassifier.html#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235562 GSM2235562 GSE84437      PAD-IV          low          low  GPL6947</span></span>
<span id="cb66-18"><a href="model-establishment-via-gsclassifier.html#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235563 GSM2235563 GSE84437      PAD-IV          low          low  GPL6947</span></span>
<span id="cb66-19"><a href="model-establishment-via-gsclassifier.html#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235564 GSM2235564 GSE84437      PAD-IV          low          low  GPL6947</span></span>
<span id="cb66-20"><a href="model-establishment-via-gsclassifier.html#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="co"># GSM2235567 GSM2235567 GSE84437      PAD-IV          low          low  GPL6947</span></span></code></pre></div>
<p>Get training data <code>Xs</code> and <code>Ys</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="model-establishment-via-gsclassifier.html#cb67-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training data</span></span>
<span id="cb67-2"><a href="model-establishment-via-gsclassifier.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  Xs <span class="ot">&lt;-</span> expr[,modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Train<span class="sc">$</span>ID]</span>
<span id="cb67-3"><a href="model-establishment-via-gsclassifier.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Train</span>
<span id="cb67-4"><a href="model-establishment-via-gsclassifier.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[<span class="fu">colnames</span>(Xs),]</span>
<span id="cb67-5"><a href="model-establishment-via-gsclassifier.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  Ys <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-I&#39;</span>,<span class="dv">1</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-II&#39;</span>,<span class="dv">2</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-III&#39;</span>,<span class="dv">3</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-IV&#39;</span>,<span class="dv">4</span>,<span class="cn">NA</span>)))); <span class="fu">table</span>(Ys)<span class="sc">/</span><span class="fu">length</span>(Ys)</span>
<span id="cb67-6"><a href="model-establishment-via-gsclassifier.html#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ys</span></span>
<span id="cb67-7"><a href="model-establishment-via-gsclassifier.html#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#         1         2         3         4 </span></span>
<span id="cb67-8"><a href="model-establishment-via-gsclassifier.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.1010169 0.2474576 0.1694915 0.4820339</span></span></code></pre></div>
<p>Get the number of subtype:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="model-establishment-via-gsclassifier.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No. of subtypes</span></span>
<span id="cb68-2"><a href="model-establishment-via-gsclassifier.html#cb68-2" aria-hidden="true" tabindex="-1"></a>nSubtype <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(Ys))</span>
<span id="cb68-3"><a href="model-establishment-via-gsclassifier.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nSubtype)</span>
<span id="cb68-4"><a href="model-establishment-via-gsclassifier.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 4</span></span></code></pre></div>
<p>Also, you can take a look at the validation data:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="model-establishment-via-gsclassifier.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validating data</span></span>
<span id="cb69-2"><a href="model-establishment-via-gsclassifier.html#cb69-2" aria-hidden="true" tabindex="-1"></a>Xs_valid <span class="ot">&lt;-</span> expr[,modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Valid<span class="sc">$</span>ID]</span>
<span id="cb69-3"><a href="model-establishment-via-gsclassifier.html#cb69-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Valid</span>
<span id="cb69-4"><a href="model-establishment-via-gsclassifier.html#cb69-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[<span class="fu">colnames</span>(Xs_valid),]</span>
<span id="cb69-5"><a href="model-establishment-via-gsclassifier.html#cb69-5" aria-hidden="true" tabindex="-1"></a>Ys_valid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-I&#39;</span>,<span class="dv">1</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-II&#39;</span>,<span class="dv">2</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-III&#39;</span>,<span class="dv">3</span>,<span class="fu">ifelse</span>(y<span class="sc">$</span>PAD_subtype <span class="sc">==</span> <span class="st">&#39;PAD-IV&#39;</span>,<span class="dv">4</span>,<span class="cn">NA</span>))))</span>
<span id="cb69-6"><a href="model-establishment-via-gsclassifier.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Ys_valid)<span class="sc">/</span><span class="fu">length</span>(Ys_valid)</span>
<span id="cb69-7"><a href="model-establishment-via-gsclassifier.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ys_valid</span></span>
<span id="cb69-8"><a href="model-establishment-via-gsclassifier.html#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co">#          1          2          3          4 </span></span>
<span id="cb69-9"><a href="model-establishment-via-gsclassifier.html#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.09609121 0.24592834 0.16612378 0.49185668</span></span></code></pre></div>
<p>Note: When you convert your phenotype into numeric, <strong>You CANNOT USE A ZERO VALUE</strong>, which is not supported by the xGboost.</p>
<p>Other parameteres for modeling:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="model-establishment-via-gsclassifier.html#cb70-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2"><a href="model-establishment-via-gsclassifier.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Build 20 models</span></span>
<span id="cb70-3"><a href="model-establishment-via-gsclassifier.html#cb70-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">20</span> </span>
<span id="cb70-4"><a href="model-establishment-via-gsclassifier.html#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="model-establishment-via-gsclassifier.html#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In every model, 70% samples in the training cohort would be selected. </span></span>
<span id="cb70-6"><a href="model-establishment-via-gsclassifier.html#cb70-6" aria-hidden="true" tabindex="-1"></a>sampSize<span class="ot">=</span><span class="fl">0.7</span></span>
<span id="cb70-7"><a href="model-establishment-via-gsclassifier.html#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="model-establishment-via-gsclassifier.html#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Seed for sampling</span></span>
<span id="cb70-9"><a href="model-establishment-via-gsclassifier.html#cb70-9" aria-hidden="true" tabindex="-1"></a>sampSeed <span class="ot">=</span> <span class="dv">2020</span></span>
<span id="cb70-10"><a href="model-establishment-via-gsclassifier.html#cb70-10" aria-hidden="true" tabindex="-1"></a>na.fill.seed <span class="ot">=</span> <span class="dv">2022</span></span>
<span id="cb70-11"><a href="model-establishment-via-gsclassifier.html#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="model-establishment-via-gsclassifier.html#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A vector for approximate gene rank estimation</span></span>
<span id="cb70-13"><a href="model-establishment-via-gsclassifier.html#cb70-13" aria-hidden="true" tabindex="-1"></a>breakVec<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb70-14"><a href="model-establishment-via-gsclassifier.html#cb70-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-15"><a href="model-establishment-via-gsclassifier.html#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 80% most variable gene &amp; gene-pairs for modeling</span></span>
<span id="cb70-16"><a href="model-establishment-via-gsclassifier.html#cb70-16" aria-hidden="true" tabindex="-1"></a>ptail<span class="ot">=</span><span class="fl">0.8</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb70-17"><a href="model-establishment-via-gsclassifier.html#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="model-establishment-via-gsclassifier.html#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Automatical selection of parameters for xGboost</span></span>
<span id="cb70-19"><a href="model-establishment-via-gsclassifier.html#cb70-19" aria-hidden="true" tabindex="-1"></a>auto <span class="ot">=</span> F</span>
<span id="cb70-20"><a href="model-establishment-via-gsclassifier.html#cb70-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-21"><a href="model-establishment-via-gsclassifier.html#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>auto){</span>
<span id="cb70-22"><a href="model-establishment-via-gsclassifier.html#cb70-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-23"><a href="model-establishment-via-gsclassifier.html#cb70-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Self-defined params. Fast.</span></span>
<span id="cb70-24"><a href="model-establishment-via-gsclassifier.html#cb70-24" aria-hidden="true" tabindex="-1"></a>      params <span class="ot">=</span> <span class="fu">list</span>(<span class="at">max_depth =</span> <span class="dv">10</span>,</span>
<span id="cb70-25"><a href="model-establishment-via-gsclassifier.html#cb70-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">eta =</span> <span class="fl">0.5</span>,</span>
<span id="cb70-26"><a href="model-establishment-via-gsclassifier.html#cb70-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb70-27"><a href="model-establishment-via-gsclassifier.html#cb70-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nthread =</span> <span class="dv">10</span>,</span>
<span id="cb70-28"><a href="model-establishment-via-gsclassifier.html#cb70-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nfold=</span><span class="dv">5</span>)</span>
<span id="cb70-29"><a href="model-establishment-via-gsclassifier.html#cb70-29" aria-hidden="true" tabindex="-1"></a>      caret.seed <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb70-30"><a href="model-establishment-via-gsclassifier.html#cb70-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-31"><a href="model-establishment-via-gsclassifier.html#cb70-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># No. of CPU for parallel computing. The optimized value depends on your CPU and RAM</span></span>
<span id="cb70-32"><a href="model-establishment-via-gsclassifier.html#cb70-32" aria-hidden="true" tabindex="-1"></a>      numCores <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb70-33"><a href="model-establishment-via-gsclassifier.html#cb70-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-34"><a href="model-establishment-via-gsclassifier.html#cb70-34" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb70-35"><a href="model-establishment-via-gsclassifier.html#cb70-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-36"><a href="model-establishment-via-gsclassifier.html#cb70-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># caret::train strategy by GSClassifier:::cvFitOneModel2. Time consuming</span></span>
<span id="cb70-37"><a href="model-establishment-via-gsclassifier.html#cb70-37" aria-hidden="true" tabindex="-1"></a>      params <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb70-38"><a href="model-establishment-via-gsclassifier.html#cb70-38" aria-hidden="true" tabindex="-1"></a>      caret.seed <span class="ot">=</span> <span class="dv">105</span></span>
<span id="cb70-39"><a href="model-establishment-via-gsclassifier.html#cb70-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-40"><a href="model-establishment-via-gsclassifier.html#cb70-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Self-defined. For this exmaple training grid, there are 2√ó1√ó1√ó3√ó2√ó1√ó2=24 grids. Make sure that you have a computer with a powerfull CPU.</span></span>
<span id="cb70-41"><a href="model-establishment-via-gsclassifier.html#cb70-41" aria-hidden="true" tabindex="-1"></a>      grid <span class="ot">=</span> <span class="fu">expand.grid</span>(</span>
<span id="cb70-42"><a href="model-establishment-via-gsclassifier.html#cb70-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrounds =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>),</span>
<span id="cb70-43"><a href="model-establishment-via-gsclassifier.html#cb70-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">colsample_bytree =</span> <span class="dv">1</span>,</span>
<span id="cb70-44"><a href="model-establishment-via-gsclassifier.html#cb70-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb70-45"><a href="model-establishment-via-gsclassifier.html#cb70-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">eta =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>),</span>
<span id="cb70-46"><a href="model-establishment-via-gsclassifier.html#cb70-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>),</span>
<span id="cb70-47"><a href="model-establishment-via-gsclassifier.html#cb70-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">subsample =</span> <span class="fl">0.7</span>,</span>
<span id="cb70-48"><a href="model-establishment-via-gsclassifier.html#cb70-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">8</span>)</span>
<span id="cb70-49"><a href="model-establishment-via-gsclassifier.html#cb70-49" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb70-50"><a href="model-establishment-via-gsclassifier.html#cb70-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb70-51"><a href="model-establishment-via-gsclassifier.html#cb70-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If you don&#39;t know how to set, just use the same number of your subtypes</span></span>
<span id="cb70-52"><a href="model-establishment-via-gsclassifier.html#cb70-52" aria-hidden="true" tabindex="-1"></a>      numCores <span class="ot">=</span> <span class="dv">4</span> </span>
<span id="cb70-53"><a href="model-establishment-via-gsclassifier.html#cb70-53" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Finaly, you have to provide your gene sets as a <code>list</code> object:</p>
<pre><code>geneSet = &lt;Your gene sets&gt;
</code></pre>
<p>Let‚Äôs take <code>PAD</code> as an example:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="model-establishment-via-gsclassifier.html#cb72-1" aria-hidden="true" tabindex="-1"></a>PAD <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;PAD.train_20220916.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;GSClassifier&quot;</span>))</span>
<span id="cb72-2"><a href="model-establishment-via-gsclassifier.html#cb72-2" aria-hidden="true" tabindex="-1"></a>geneSet <span class="ot">&lt;-</span> PAD<span class="sc">$</span>geneSet</span>
<span id="cb72-3"><a href="model-establishment-via-gsclassifier.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geneSet)</span>
<span id="cb72-4"><a href="model-establishment-via-gsclassifier.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># $PIAM</span></span>
<span id="cb72-5"><a href="model-establishment-via-gsclassifier.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] &quot;ENSG00000122122&quot; &quot;ENSG00000117091&quot; &quot;ENSG00000163219&quot; &quot;ENSG00000136167&quot;</span></span>
<span id="cb72-6"><a href="model-establishment-via-gsclassifier.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  [5] &quot;ENSG00000005844&quot; &quot;ENSG00000123338&quot; &quot;ENSG00000102879&quot; &quot;ENSG00000010671&quot;</span></span>
<span id="cb72-7"><a href="model-establishment-via-gsclassifier.html#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  [9] &quot;ENSG00000185862&quot; &quot;ENSG00000104814&quot; &quot;ENSG00000134516&quot; &quot;ENSG00000100055&quot;</span></span>
<span id="cb72-8"><a href="model-establishment-via-gsclassifier.html#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># [13] &quot;ENSG00000082074&quot; &quot;ENSG00000113263&quot; &quot;ENSG00000153283&quot; &quot;ENSG00000198821&quot;</span></span>
<span id="cb72-9"><a href="model-establishment-via-gsclassifier.html#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [17] &quot;ENSG00000185811&quot; &quot;ENSG00000117090&quot; &quot;ENSG00000171608&quot;</span></span>
<span id="cb72-10"><a href="model-establishment-via-gsclassifier.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb72-11"><a href="model-establishment-via-gsclassifier.html#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># $PIDG</span></span>
<span id="cb72-12"><a href="model-establishment-via-gsclassifier.html#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1] &quot;ENSG00000116667&quot; &quot;ENSG00000107771&quot; &quot;ENSG00000196782&quot; &quot;ENSG00000271447&quot;</span></span>
<span id="cb72-13"><a href="model-establishment-via-gsclassifier.html#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  [5] &quot;ENSG00000173517&quot; &quot;ENSG00000134686&quot; &quot;ENSG00000100614&quot; &quot;ENSG00000134247&quot;</span></span>
<span id="cb72-14"><a href="model-establishment-via-gsclassifier.html#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  [9] &quot;ENSG00000109686&quot; &quot;ENSG00000197321&quot; &quot;ENSG00000179981&quot; &quot;ENSG00000187189&quot;</span></span>
<span id="cb72-15"><a href="model-establishment-via-gsclassifier.html#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [13] &quot;ENSG00000140836&quot;</span></span></code></pre></div>
</div>
<div id="fitting-models" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Fitting models</h2>
<div id="gsclassifier-model-training" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> GSClassifier model training</h3>
<p>Just fit the model like:</p>
<pre><code>
if(!auto){
  
  # Self-defined
  
  system.time(
    res &lt;- fitEnsembleModel(Xs,
                            Ys,
                            geneSet = geneSet,
                            na.fill.method = c(&#39;quantile&#39;,&#39;rpart&#39;,NULL)[1],
                            na.fill.seed = na.fill.seed,
                            n = n,
                            sampSize = sampSize,
                            sampSeed = sampSeed ,
                            breakVec = breakVec,
                            params = params,
                            ptail = ptail,
                            caret.grid = NULL,
                            caret.seed =  caret.seed,
                            verbose = verbose,
                            numCores = numCores)
  )
  
  # user   system  elapsed
  # 0.08s  0.18s   92.70s
  
} else {
  
  # caret::train-defined and time-consuming
  system.time(
    res &lt;- fitEnsembleModel(Xs,
                            Ys,
                            geneSet = geneSet,
                            na.fill.method = c(&#39;quantile&#39;,&#39;rpart&#39;,NULL)[1],
                            na.fill.seed = na.fill.seed,
                            n = n,
                            sampSize = sampSize,
                            sampSeed = sampSeed ,
                            breakVec = breakVec,
                            params = NULL,  # This must be NULL
                            ptail = ptail,
                            caret.grid = grid,
                            caret.seed =  caret.seed,
                            verbose = verbose,
                            numCores = numCores)
  )
  
  # user   system   elapsed
  # 1.10s  2.60s    2311.55s
}

mymusic() # Remind me with a music when the process completed
</code></pre>
<p>You should save it for convenience:</p>
<pre><code>saveRDS(res,&#39;&lt;your path&gt;/train_ens.rds&#39;)</code></pre>
<p>Although a <code>auto-parameter strategy</code> was provided in<code>GSClassifier</code>, it‚Äôs unknown for this method to improve your model performance to what extent. You can just try. It‚Äôs not a prior recommendation. In generall, setting <code>auto=F</code> in this script could be more cost-effective. Empirically, the speed of <code>caret::train</code> depends on single-core performance of the CPU instead of the core number.</p>
</div>
<div id="scaller-for-the-best-call" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Scaller for the best call</h3>
<p>Next, we model the <code>scaller</code> for the training cohort, which would be used for <code>BestCall</code> based on the <code>probability matrix</code> in <code>callEnsemble</code> series. Here, <code>scaller=NULL</code> would cause an <code>NA</code> value of <code>BestCall</code> col.¬†It‚Äôs not a big deal, because the <code>probability matrix</code> is the information we need.</p>
<pre><code># Time-consuming modeling
resTrain &lt;- parCallEnsemble(X = Xs,
                            ens = res$Model,
                            geneAnnotation = res$geneAnnotation,
                            geneSet = geneSet,
                            scaller = NULL,
                            geneids = &quot;ensembl&quot;,
                            subtype = NULL,
                            numCores = numCores)

# xgboost via best interation
library(xgboost)
dtrain &lt;- xgb.DMatrix(as.matrix(resTrain[4:(3 + nSubtype)]), label = Ys-1)

cvRes &lt;- xgb.cv(data = dtrain,
                nrounds=100,
                nthread=10,
                nfold=5,
                max_depth=5,
                eta=0.5,
                early_stopping_rounds=100,
                num_class = 4,
                objective = &quot;multi:softmax&quot;)

# xgboost via best interation
bst &lt;- xgboost(data = dtrain,
               max_depth=5,
               eta=0.5,
               nrounds = cvRes$best_iteration,
               nthread=10,
               num_class = 4,
               objective = &quot;multi:softmax&quot;)
Ys_pred &lt;- predict(bst, as.matrix(resTrain[4:7])) + 1
mean(Ys_pred == Ys) # Prediction rates

# Ensemble results
scaller.train &lt;- list(
      Repeat = list(
        data = dtrain,
        max_depth=5,
        eta=0.5,
        nrounds = cvRes$best_iteration,
        nthread=10,
        num_class = 4,
        objective = &quot;multi:softmax&quot;
      ), 
      Model = bst
    )
</code></pre>
</div>
<div id="assemble-your-model" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Assemble your model</h3>
<blockquote>
<p>For more information of <code>geneAnnotation</code>, you could see <a href="https://github.com/huangwb8/GSClassifier/wiki/Advanced-development#Gene-Annotation">Advanced development: Gene Annotation</a> section for assistance.</p>
</blockquote>
<p>Here we give an example:</p>
<pre><code>l.train &lt;- list()

# bootstrap models based on the training cohort
l.train[[&#39;ens&#39;]] &lt;- res 

# Scaller model
l.train[[&#39;scaller&#39;]] &lt;- scaller.train 

# a data frame contarining gene annotation for IDs convertion
l.train[[&#39;geneAnnotation&#39;]] &lt;- &lt;Your gene annotation&gt;

# Your gene sets
l.train[[&#39;geneSet&#39;]] &lt;- geneSet
</code></pre>
<p>Finally, save it for downstream analysis</p>
<pre><code>saveRDS(l.train,&#39;&lt;Your path&gt;/train.rds&#39;)
</code></pre>
<p>About model constributions, you can go <code>Advanced development</code> in <a href="https://github.com/huangwb8/GSClassifier/wiki/Advanced-development">here</a> or <a href="http://htmlpreview.github.io/?https://raw.githubusercontent.com/wiki/huangwb8/GSClassifier/Advanced-development.html">here</a> for more information.</p>
</div>
<div id="of-note-2" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Of note</h3>
<p>You can take a look at the <code>PAD.train_20220916</code> model (<code>PADi</code>). You have to make your model frame similar to the <code>PAD.train_20220916</code> model.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="model-establishment-via-gsclassifier.html#cb78-1" aria-hidden="true" tabindex="-1"></a>l.train <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;PAD.train_20220916.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;GSClassifier&quot;</span>))</span>
<span id="cb78-2"><a href="model-establishment-via-gsclassifier.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(l.train)</span>
<span id="cb78-3"><a href="model-establishment-via-gsclassifier.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;ens&quot;            &quot;scaller&quot;        &quot;geneAnnotation&quot; &quot;geneSet&quot;</span></span></code></pre></div>
<p>The time of <code>GSClassifier</code> modeling depends on the number of individual models (controlled by <code>n</code>)/called subtypes/gene signatures, automatic parameter selection, and your CPU capacity.</p>
</div>
</div>
<div id="calling-subtypes" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Calling subtypes</h2>
<p>Supposed that you had got a <code>GSClassifier</code> model, next you want to use it for personalized subtype calling.</p>
<p>Just:</p>
<pre><code># Load your model
l &lt;- readRDS(&#39;&lt;Your path&gt;/train.rds&#39;)

# subtype calling
res_i = callEnsemble(
  X,
  ens = l$ens$Model,
  geneAnnotation = l$geneAnnotation,
  geneSet = l$geneSet,
  scaller = l$scaller$Model,
  geneid = &lt;ID type of your training data&gt;,
  subtype = NULL,
  verbose = T
)
</code></pre>
<p>The usage of <code>parCallEnsemble</code> (for huge amount of samples) is similar.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="quick-start.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="suggestions-for-gsclassifier-model-developers.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GSClassifier.principle.pdf", "GSClassifier.principle.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
