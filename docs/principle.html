<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>The Principle of R Package GSClassifier</title>
  <meta name="description" content="The Principle of GSClassifier" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="The Principle of R Package GSClassifier" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Principle of GSClassifier" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The Principle of R Package GSClassifier" />
  
  <meta name="twitter:description" content="The Principle of GSClassifier" />
  

<meta name="author" content="Weibin Huang" />


<meta name="date" content="2022-09-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GSClassifier</a></li>

<li class="divider"></li>
<li><a href="principle.html#principle" id="toc-principle"><span class="toc-section-number">1</span> Principle</a>
<ul>
<li><a href="principle.html#introduction" id="toc-introduction"><span class="toc-section-number">1.1</span> Introduction</a></li>
<li><a href="principle.html#flowchart" id="toc-flowchart"><span class="toc-section-number">1.2</span> Flowchart</a></li>
<li><a href="principle.html#data-processing" id="toc-data-processing"><span class="toc-section-number">1.3</span> Data Processing</a></li>
<li><a href="principle.html#top-scoring-pairs-tsp-matrix" id="toc-top-scoring-pairs-tsp-matrix"><span class="toc-section-number">1.4</span> Top scoring pairs (TSP) matrix</a>
<ul>
<li><a href="principle.html#simulated-dataset" id="toc-simulated-dataset"><span class="toc-section-number">1.4.1</span> Simulated Dataset</a></li>
<li><a href="principle.html#binned-expression" id="toc-binned-expression"><span class="toc-section-number">1.4.2</span> Binned expression</a></li>
<li><a href="principle.html#genes-with-large-rank-differences" id="toc-genes-with-large-rank-differences"><span class="toc-section-number">1.4.3</span> Genes with large rank differences</a></li>
<li><a href="principle.html#pair-scores-of-top-genes" id="toc-pair-scores-of-top-genes"><span class="toc-section-number">1.4.4</span> Pair scores of top genes</a></li>
<li><a href="principle.html#gene-set-difference-score" id="toc-gene-set-difference-score"><span class="toc-section-number">1.4.5</span> Gene set difference score</a></li>
</ul></li>
</ul></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li><a href="https://blognas.hwb0307.com/" target="blank">My blog</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Principle of R Package GSClassifier</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">The Principle of R Package GSClassifier</h1>
<p class="author"><em>Weibin Huang</em></p>
<p class="date"><em>2022-09-13</em></p>
</div>
<div id="principle" class="section level1" number="1">
<h1><span class="header-section-number">Chapter 1</span> Principle</h1>
<div id="introduction" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction</h2>
<p><a href="https://github.com/huangwb8/GSClassifier">GSClassifier</a> is an R package for modeling and identification of gene expression profiles (GEPs) subtypes. The detail of usage had been demonstrated in <a href="https://github.com/huangwb8/GSClassifier/wiki">Github WiKi</a>. Here, we propose to introduce the principle of GSClassifier, including flowchart, <strong>top scoring pairs (TSP)</strong> algorithm, and batch effect control.</p>
</div>
<div id="flowchart" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Flowchart</h2>
<p>The flowchart of <code>GSClassifier</code> is showed in Figure <a href="principle.html#fig:flowchart">1.1</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:flowchart"></span>
<img src="fig/flowchart.png" alt="The flow chart of GSClassifier" width="90%" />
<p class="caption">
Figure 1.1: The flow chart of GSClassifier
</p>
</div>
</div>
<div id="data-processing" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Data Processing</h2>
<p>For each dataset, the RNA expression matrix would be normalized (we called <code>Raw Matrix</code> in the flowchart) internally so that the expression data of the samples in the dataset were comparable.</p>
<p>Next, the subtypes of the samples in each dataset would be called based on cluster analysis. Specially, we figured out PAD subtypes, which belong to <code>Subtype Vector</code> in the flowchart, via hierarchical clustering analysis.</p>
</div>
<div id="top-scoring-pairs-tsp-matrix" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Top scoring pairs (TSP) matrix</h2>
<p>With <code>subtype vectors</code> and <code>Raw Matrix</code>, the TSP matrix for a specified subtypes could be calculated via function <code>GSClassifier::trainDataProc</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="principle.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">trainDataProc</span>(</span>
<span id="cb1-2"><a href="principle.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  Xmat, Yvec,</span>
<span id="cb1-3"><a href="principle.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-4"><a href="principle.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  geneSet, </span>
<span id="cb1-5"><a href="principle.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="principle.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtype =</span> <span class="dv">1</span>, </span>
<span id="cb1-7"><a href="principle.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="principle.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 0.2 was Used in PAD project</span></span>
<span id="cb1-9"><a href="principle.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ptail =</span> <span class="fl">0.2</span>,</span>
<span id="cb1-10"><a href="principle.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="principle.html#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c(0, 0.25, 0.5, 0.75, 1.0) was Used in PAD project</span></span>
<span id="cb1-12"><a href="principle.html#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">breakVec =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb1-13"><a href="principle.html#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The TSP matrix consists of 3 parts: <strong>binned expression matrix</strong>, <strong>top scoring of gene pairs</strong>, and <strong>gene set pairs</strong>.</p>
<p>Here, we would use some simulated data to introduce how TSP matrix calculated.</p>
<div id="simulated-dataset" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Simulated Dataset</h3>
<p>Load packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="principle.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install &quot;devtools&quot; package</span></span>
<span id="cb2-2"><a href="principle.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;devtools&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-3"><a href="principle.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb2-4"><a href="principle.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="principle.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb2-6"><a href="principle.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;luckyBase&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-7"><a href="principle.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;huangwb8/luckyBase&quot;</span>)</span>
<span id="cb2-8"><a href="principle.html#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="principle.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the &quot;GSClassifier&quot; package</span></span>
<span id="cb2-10"><a href="principle.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;GSClassifier&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-11"><a href="principle.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;huangwb8/GSClassifier&quot;</span>)</span>
<span id="cb2-12"><a href="principle.html#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="principle.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install CRAN packages</span></span>
<span id="cb2-14"><a href="principle.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;pacman&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb2-15"><a href="principle.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span>
<span id="cb2-16"><a href="principle.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pacman)</span>
<span id="cb2-17"><a href="principle.html#cb2-17" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-18"><a href="principle.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pacman)</span>
<span id="cb2-19"><a href="principle.html#cb2-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-20"><a href="principle.html#cb2-20" aria-hidden="true" tabindex="-1"></a>packages_needed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;readxl&quot;</span>,<span class="st">&quot;ComplexHeatmap&quot;</span>,<span class="st">&quot;GSClassifier&quot;</span>)</span>
<span id="cb2-21"><a href="principle.html#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> packages_needed){<span class="fu">p_load</span>(<span class="at">char=</span>i)}</span></code></pre></div>
<p>We simulated a dataset:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="principle.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Geneset</span></span>
<span id="cb3-2"><a href="principle.html#cb3-2" aria-hidden="true" tabindex="-1"></a>geneSet <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-3"><a href="principle.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Set1 =</span> <span class="fu">paste</span>(<span class="st">&#39;Gene&#39;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">sep =</span> <span class="st">&#39;&#39;</span>),</span>
<span id="cb3-4"><a href="principle.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Set2 =</span> <span class="fu">paste</span>(<span class="st">&#39;Gene&#39;</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>,<span class="at">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb3-5"><a href="principle.html#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="principle.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="principle.html#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="principle.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA expression</span></span>
<span id="cb3-9"><a href="principle.html#cb3-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&#39;./data/simulated-data.xlsx&#39;</span>, <span class="at">sheet =</span> <span class="st">&#39;RNA&#39;</span>)</span></code></pre></div>
<pre><code>New names:</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="principle.html#cb5-1" aria-hidden="true" tabindex="-1"></a>expr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb5-2"><a href="principle.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(expr) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.matrix</span>(x[,<span class="dv">1</span>])); <span class="fu">rm</span>(x)</span>
<span id="cb5-3"><a href="principle.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="principle.html#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="principle.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb5-6"><a href="principle.html#cb5-6" aria-hidden="true" tabindex="-1"></a>breakVec <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb5-7"><a href="principle.html#cb5-7" aria-hidden="true" tabindex="-1"></a>subtype_vector <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb5-8"><a href="principle.html#cb5-8" aria-hidden="true" tabindex="-1"></a>Ybin <span class="ot">=</span> <span class="fu">ifelse</span>(subtype_vector <span class="sc">==</span> <span class="dv">1</span>, <span class="at">yes =</span> <span class="dv">1</span>, <span class="at">no=</span><span class="dv">0</span>)</span>
<span id="cb5-9"><a href="principle.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="principle.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Report</span></span>
<span id="cb5-11"><a href="principle.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">c</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>, <span class="st">&#39;Gene sets:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>))</span>
<span id="cb5-12"><a href="principle.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geneSet)</span>
<span id="cb5-13"><a href="principle.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;RNA expression:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb5-14"><a href="principle.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expr)</span></code></pre></div>
<pre><code>
 Gene sets: 
$Set1
[1] &quot;Gene1&quot; &quot;Gene2&quot; &quot;Gene3&quot;

$Set2
[1] &quot;Gene4&quot; &quot;Gene5&quot; &quot;Gene6&quot;

RNA expression: 
      Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
Gene1    0.51    0.52    0.60    0.21    0.30    0.40
Gene2    0.52    0.54    0.58    0.22    0.31    0.35
Gene3    0.53    0.60    0.61    0.23    0.29    0.30
Gene4    0.21    0.30    0.40    0.51    0.52    0.60
Gene5    0.22    0.31    0.35    0.52    0.54    0.58
Gene6    0.23    0.29    0.30    0.53    0.60    0.61
Gene7    0.10    0.12    0.09    0.11    0.12    0.14</code></pre>
<p>Have a look at the matrix:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="principle.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Heatmap</span>(<span class="fu">t</span>(<span class="fu">scale</span>(<span class="fu">t</span>(expr))), <span class="at">name =</span> <span class="st">&quot;Z-score&quot;</span>)</span></code></pre></div>
<p><img src="Flowchart_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="binned-expression" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Binned expression</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="principle.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data of one sample</span></span>
<span id="cb8-2"><a href="principle.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="principle.html#cb8-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> expr[,<span class="dv">1</span>]</span>
<span id="cb8-4"><a href="principle.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="principle.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create quantiles  </span></span>
<span id="cb8-6"><a href="principle.html#cb8-6" aria-hidden="true" tabindex="-1"></a>brks <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">as.numeric</span>(x), </span>
<span id="cb8-7"><a href="principle.html#cb8-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">probs=</span>breakVec, </span>
<span id="cb8-8"><a href="principle.html#cb8-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> T)</span>
<span id="cb8-9"><a href="principle.html#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="principle.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get interval orders</span></span>
<span id="cb8-11"><a href="principle.html#cb8-11" aria-hidden="true" tabindex="-1"></a>xbin <span class="ot">&lt;-</span> <span class="fu">.bincode</span>(<span class="at">x =</span> x, </span>
<span id="cb8-12"><a href="principle.html#cb8-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">breaks =</span> brks, </span>
<span id="cb8-13"><a href="principle.html#cb8-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">include.lowest =</span> T)</span>
<span id="cb8-14"><a href="principle.html#cb8-14" aria-hidden="true" tabindex="-1"></a>xbin <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(xbin)</span>
<span id="cb8-15"><a href="principle.html#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="principle.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Report</span></span>
<span id="cb8-17"><a href="principle.html#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Quantiles:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>); <span class="fu">print</span>(brks)</span>
<span id="cb8-18"><a href="principle.html#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb8-19"><a href="principle.html#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Raw expression:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>);<span class="fu">print</span>(<span class="fu">as.numeric</span>(x))</span>
<span id="cb8-20"><a href="principle.html#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb8-21"><a href="principle.html#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Binned expression:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>); <span class="fu">print</span>(xbin)</span></code></pre></div>
<pre><code>Quantiles: 
   0%   25%   50%   75%  100% 
0.100 0.215 0.230 0.515 0.530 

Raw expression: 
[1] 0.51 0.52 0.53 0.21 0.22 0.23 0.10

Binned expression: 
[1] 3 4 4 1 2 2 1</code></pre>
<p>For example, <code>0.10</code> is the minimun of the raw expression vector, so its binned expression is <code>1</code>. Similarly, the binned expression of maximum <code>0.53</code> is <code>4</code>.</p>
<p>We calculated binned expression via function <code>breakBin</code> in <code>GSClassifier</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="principle.html#cb10-1" aria-hidden="true" tabindex="-1"></a>expr_binned <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb10-2"><a href="principle.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  expr, <span class="dv">2</span>, </span>
<span id="cb10-3"><a href="principle.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  GSClassifier<span class="sc">:::</span>breakBin,</span>
<span id="cb10-4"><a href="principle.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  breakVec)</span>
<span id="cb10-5"><a href="principle.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(expr_binned) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(expr)</span>
<span id="cb10-6"><a href="principle.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expr_binned)</span></code></pre></div>
<pre><code>      Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
Gene1       3       3       4       1       2       2
Gene2       4       4       3       2       2       2
Gene3       4       4       4       2       1       1
Gene4       1       2       2       3       3       4
Gene5       2       2       2       4       4       3
Gene6       2       1       1       4       4       4
Gene7       1       1       1       1       1       1</code></pre>
</div>
<div id="genes-with-large-rank-differences" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Genes with large rank differences</h3>
<p>In this simulated dataset, <code>Gene7</code> is a gene whose expression is always the lowest across all samples. In other words, the rank of <code>Gene7</code> is stable or invariable across samples so that it’s not robust for identification of differentail subtypes.</p>
<p>Except binned expression, we also calculated gene-pair scores later. Due to the number of gene-pair is <span class="math inline">\(C_{2 \atop n}\)</span>, the removement of genes like <code>Gene7</code> before modeling could really reduce the complexibility of the model and save computing resources. In all, genes like <code>Gene7</code> could be dropped out in the following analysis.</p>
<p>First, We use <code>base::rank</code>to return the sample ranks of the values in a vector:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="principle.html#cb12-1" aria-hidden="true" tabindex="-1"></a>expr_binned_rank <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb12-2"><a href="principle.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  expr_binned, </span>
<span id="cb12-3"><a href="principle.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, </span>
<span id="cb12-4"><a href="principle.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x)<span class="fu">rank</span>(x, <span class="at">na.last =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="principle.html#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="principle.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expr_binned_rank)</span></code></pre></div>
<pre><code>      Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
Gene1     5.0     5.0     6.5     1.5     3.5     3.5
Gene2     6.5     6.5     5.0     3.5     3.5     3.5
Gene3     6.5     6.5     6.5     3.5     1.5     1.5
Gene4     1.5     3.5     3.5     5.0     5.0     6.5
Gene5     3.5     3.5     3.5     6.5     6.5     5.0
Gene6     3.5     1.5     1.5     6.5     6.5     6.5
Gene7     1.5     1.5     1.5     1.5     1.5     1.5</code></pre>
<p><code>na.last = TRUE</code> means that missing values in the data are put last.</p>
<p>Then, get rank differences of each gene based on specified subtype distribution (<code>Ybin</code>):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="principle.html#cb14-1" aria-hidden="true" tabindex="-1"></a>testRes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb14-2"><a href="principle.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(expr_binned_rank), </span>
<span id="cb14-3"><a href="principle.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(gi) <span class="fu">testFun</span>(<span class="fu">as.numeric</span>(expr_binned_rank[gi,]), Ybin)</span>
<span id="cb14-4"><a href="principle.html#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-5"><a href="principle.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(testRes) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(expr_binned_rank)</span>
<span id="cb14-6"><a href="principle.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(testRes)</span></code></pre></div>
<pre><code>    Gene1     Gene2     Gene3     Gene4     Gene5     Gene6     Gene7 
-2.666667 -2.500000 -4.333333  2.666667  2.500000  4.333333  0.000000 </code></pre>
<p><code>Gene7</code> is the one with the lowest absolute value (0) of rank diffrence.</p>
<p>In <code>GSClassifier</code>, we use <code>ptail</code> to select differential genes based on rank diffrences. <strong>Less <code>ptail</code> is, less gene kept</strong>. Here, we just set <code>ptail=0.4</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="principle.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ptail is a numeber ranging (0,0.5].</span></span>
<span id="cb16-2"><a href="principle.html#cb16-2" aria-hidden="true" tabindex="-1"></a>ptail <span class="ot">=</span> <span class="fl">0.4</span></span>
<span id="cb16-3"><a href="principle.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="principle.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Index of target genes with big rank differences</span></span>
<span id="cb16-5"><a href="principle.html#cb16-5" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>((testRes <span class="sc">&lt;</span> <span class="fu">quantile</span>(testRes, ptail, <span class="at">na.rm =</span> T)) <span class="sc">|</span> </span>
<span id="cb16-6"><a href="principle.html#cb16-6" aria-hidden="true" tabindex="-1"></a>             (testRes <span class="sc">&gt;</span> <span class="fu">quantile</span>(testRes, <span class="fl">1.0</span><span class="sc">-</span>ptail, <span class="at">na.rm =</span> T)))</span>
<span id="cb16-7"><a href="principle.html#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="principle.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Target genes</span></span>
<span id="cb16-9"><a href="principle.html#cb16-9" aria-hidden="true" tabindex="-1"></a>gene_bigRank <span class="ot">&lt;-</span> <span class="fu">names</span>(testRes)[idx]</span>
<span id="cb16-10"><a href="principle.html#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="principle.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Report</span></span>
<span id="cb16-12"><a href="principle.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Index of target genes: &#39;</span>,<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>);<span class="fu">print</span>(idx); <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb16-13"><a href="principle.html#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Target genes:&#39;</span>,<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>);<span class="fu">print</span>(gene_bigRank); <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>Index of target genes:  
Gene1 Gene2 Gene3 Gene4 Gene5 Gene6 
    1     2     3     4     5     6 

Target genes: 
[1] &quot;Gene1&quot; &quot;Gene2&quot; &quot;Gene3&quot; &quot;Gene4&quot; &quot;Gene5&quot; &quot;Gene6&quot;</code></pre>
<p>Hence, <code>Gene7</code> was filtered and excluded in the following analysis. In practice, both <code>ptail</code> and <code>breakVec</code> are hyperparameters in modeling.</p>
</div>
<div id="pair-scores-of-top-genes" class="section level3" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Pair scores of top genes</h3>
<p>In GSClassifier, we use function <code>makeGenePairs</code> to calculate s</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="principle.html#cb18-1" aria-hidden="true" tabindex="-1"></a>gene_bigRank_pairs <span class="ot">&lt;-</span> GSClassifier<span class="sc">:::</span><span class="fu">makeGenePairs</span>(</span>
<span id="cb18-2"><a href="principle.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  gene_bigRank, </span>
<span id="cb18-3"><a href="principle.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  expr[gene_bigRank,])</span>
<span id="cb18-4"><a href="principle.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gene_bigRank_pairs)</span></code></pre></div>
<pre><code>            Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
Gene1:Gene2       0       0       1       0       0       1
Gene1:Gene3       0       0       0       0       1       1
Gene1:Gene4       1       1       1       0       0       0
Gene1:Gene5       1       1       1       0       0       0
Gene1:Gene6       1       1       1       0       0       0
Gene2:Gene3       0       0       0       0       1       1
Gene2:Gene4       1       1       1       0       0       0
Gene2:Gene5       1       1       1       0       0       0
Gene2:Gene6       1       1       1       0       0       0
Gene3:Gene4       1       1       1       0       0       0
Gene3:Gene5       1       1       1       0       0       0
Gene3:Gene6       1       1       1       0       0       0
Gene4:Gene5       0       0       1       0       0       1
Gene4:Gene6       0       1       1       0       0       0
Gene5:Gene6       0       1       1       0       0       0</code></pre>
<p>Take <code>Gene1:Gene4</code> of <code>Sample1</code> as an example. <span class="math inline">\(Expression_{Gene1} - Expression_{Gene4} = 0.51-0.21 = 0.3 &gt; 0\)</span>, so the pair score is 1; if the difference is ≤0, the pair score is 0 instead.</p>
</div>
<div id="gene-set-difference-score" class="section level3" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Gene set difference score</h3>
<p>In GSClassifier, we use function <code>makeSetData</code> to calculate gene set difference score:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="principle.html#cb20-1" aria-hidden="true" tabindex="-1"></a>geneset_interaction <span class="ot">&lt;-</span> GSClassifier<span class="sc">:::</span><span class="fu">makeSetData</span>(expr,geneSet)</span>
<span id="cb20-2"><a href="principle.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geneset_interaction)</span></code></pre></div>
<pre><code>     Sample1 Sample2 Sample3 Sample4 Sample5 Sample6
s1s2       1       1       1       0       0       0</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="references.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GSClassifier.principle.pdf", "GSClassifier.principle.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
