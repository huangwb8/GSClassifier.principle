<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Discussion | The Principle of R Package GSClassifier</title>
  <meta name="description" content="The Principle of GSClassifier" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Discussion | The Principle of R Package GSClassifier" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Principle of GSClassifier" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Discussion | The Principle of R Package GSClassifier" />
  
  <meta name="twitter:description" content="The Principle of GSClassifier" />
  

<meta name="author" content="Weibin Huang" />


<meta name="date" content="2022-09-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-principle-of-gsclassifier.html"/>
<link rel="next" href="quick-start.html"/>
<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GSClassifier</a></li>

<li class="divider"></li>
<li><a href="index.html#welcome" id="toc-welcome">Welcome</a>
<ul>
<li><a href="index.html#about" id="toc-about">üí¶About</a></li>
<li><a href="index.html#license" id="toc-license">üíøLicense</a></li>
<li><a href="index.html#installation" id="toc-installation">üëçInstallation</a></li>
<li><a href="index.html#mirror" id="toc-mirror">üëÄ<span>Mirror</span></a></li>
<li><a href="index.html#change-log" id="toc-change-log">üìöChange log</a></li>
<li><a href="index.html#todo" id="toc-todo">üìÜTODO</a></li>
<li><a href="index.html#other-projects" id="toc-other-projects">üå¥Other Projects</a></li>
</ul></li>
<li><a href="the-principle-of-gsclassifier.html#the-principle-of-gsclassifier" id="toc-the-principle-of-gsclassifier"><span class="toc-section-number">1</span> The Principle of GSClassifier</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#packages" id="toc-packages"><span class="toc-section-number">1.1</span> Packages</a></li>
<li><a href="the-principle-of-gsclassifier.html#flowchart" id="toc-flowchart"><span class="toc-section-number">1.2</span> Flowchart</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#data-processing" id="toc-data-processing"><span class="toc-section-number">1.2.1</span> Data Processing</a></li>
<li><a href="the-principle-of-gsclassifier.html#model-establishment-and-validation" id="toc-model-establishment-and-validation"><span class="toc-section-number">1.2.2</span> Model Establishment and Validation</a></li>
<li><a href="the-principle-of-gsclassifier.html#model-application" id="toc-model-application"><span class="toc-section-number">1.2.3</span> Model Application</a></li>
</ul></li>
<li><a href="the-principle-of-gsclassifier.html#topicTSP" id="toc-topicTSP"><span class="toc-section-number">1.3</span> Top scoring pairs</a>
<ul>
<li><a href="the-principle-of-gsclassifier.html#tsp-intro" id="toc-tsp-intro"><span class="toc-section-number">1.3.1</span> Introduction</a></li>
<li><a href="the-principle-of-gsclassifier.html#simulated-dataset" id="toc-simulated-dataset"><span class="toc-section-number">1.3.2</span> Simulated Dataset</a></li>
<li><a href="the-principle-of-gsclassifier.html#binned-expression" id="toc-binned-expression"><span class="toc-section-number">1.3.3</span> Binned expression</a></li>
<li><a href="the-principle-of-gsclassifier.html#pair-difference" id="toc-pair-difference"><span class="toc-section-number">1.3.4</span> Pair difference</a></li>
<li><a href="the-principle-of-gsclassifier.html#set-difference" id="toc-set-difference"><span class="toc-section-number">1.3.5</span> Set difference</a></li>
</ul></li>
</ul></li>
<li><a href="discussion.html#discussion" id="toc-discussion"><span class="toc-section-number">2</span> Discussion</a>
<ul>
<li><a href="discussion.html#packages-1" id="toc-packages-1"><span class="toc-section-number">2.1</span> Packages</a></li>
<li><a href="discussion.html#missing-value-imputation-mvi" id="toc-missing-value-imputation-mvi"><span class="toc-section-number">2.2</span> Missing value imputation (MVI)</a></li>
<li><a href="discussion.html#batch-effect" id="toc-batch-effect"><span class="toc-section-number">2.3</span> Batch effect</a></li>
<li><a href="discussion.html#subtype-number" id="toc-subtype-number"><span class="toc-section-number">2.4</span> Subtype number</a></li>
</ul></li>
<li><a href="quick-start.html#quick-start" id="toc-quick-start"><span class="toc-section-number">3</span> Quick start</a>
<ul>
<li><a href="quick-start.html#about-1" id="toc-about-1"><span class="toc-section-number">3.1</span> About</a></li>
<li><a href="quick-start.html#package" id="toc-package"><span class="toc-section-number">3.2</span> Package</a></li>
<li><a href="quick-start.html#data" id="toc-data"><span class="toc-section-number">3.3</span> Data</a></li>
<li><a href="quick-start.html#pad" id="toc-pad"><span class="toc-section-number">3.4</span> PAD</a>
<ul>
<li><a href="quick-start.html#preparation-of-the-test-data" id="toc-preparation-of-the-test-data"><span class="toc-section-number">3.4.1</span> Preparation of the test data</a></li>
<li><a href="quick-start.html#unsupervised-clustering" id="toc-unsupervised-clustering"><span class="toc-section-number">3.4.2</span> Unsupervised clustering</a></li>
<li><a href="quick-start.html#of-note" id="toc-of-note"><span class="toc-section-number">3.4.3</span> Of note</a></li>
</ul></li>
<li><a href="quick-start.html#padi" id="toc-padi"><span class="toc-section-number">3.5</span> PADi</a>
<ul>
<li><a href="quick-start.html#preparation-of-the-test-data-1" id="toc-preparation-of-the-test-data-1"><span class="toc-section-number">3.5.1</span> Preparation of the test data</a></li>
<li><a href="quick-start.html#use-a-specific-function-called-padi" id="toc-use-a-specific-function-called-padi"><span class="toc-section-number">3.5.2</span> Use a specific function called <code>PADi</code></a></li>
<li><a href="quick-start.html#use-the-callensemble-function" id="toc-use-the-callensemble-function"><span class="toc-section-number">3.5.3</span> Use the <code>callEnsemble</code> function</a></li>
<li><a href="quick-start.html#parallel-strategy-for-padi" id="toc-parallel-strategy-for-padi"><span class="toc-section-number">3.5.4</span> Parallel strategy for PADi</a></li>
<li><a href="quick-start.html#single-sample-subtype-calling" id="toc-single-sample-subtype-calling"><span class="toc-section-number">3.5.5</span> Single sample subtype calling</a></li>
<li><a href="quick-start.html#of-note-1" id="toc-of-note-1"><span class="toc-section-number">3.5.6</span> Of note</a></li>
</ul></li>
<li><a href="quick-start.html#use-external-models-from-luckymodel-package" id="toc-use-external-models-from-luckymodel-package"><span class="toc-section-number">3.6</span> Use external models from luckyModel package</a></li>
<li><a href="quick-start.html#pancancer-immune-subtypes" id="toc-pancancer-immune-subtypes"><span class="toc-section-number">3.7</span> PanCancer immune subtypes</a></li>
</ul></li>
<li><a href="model-establishment-via-gsclassifier.html#model-establishment-via-gsclassifier" id="toc-model-establishment-via-gsclassifier"><span class="toc-section-number">4</span> Model establishment via GSClassifier</a>
<ul>
<li><a href="model-establishment-via-gsclassifier.html#about-2" id="toc-about-2"><span class="toc-section-number">4.1</span> About</a></li>
<li><a href="model-establishment-via-gsclassifier.html#data-preparation" id="toc-data-preparation"><span class="toc-section-number">4.2</span> Data preparation</a></li>
<li><a href="model-establishment-via-gsclassifier.html#fitting-models" id="toc-fitting-models"><span class="toc-section-number">4.3</span> Fitting models</a>
<ul>
<li><a href="model-establishment-via-gsclassifier.html#gsclassifier-model-training" id="toc-gsclassifier-model-training"><span class="toc-section-number">4.3.1</span> GSClassifier model training</a></li>
<li><a href="model-establishment-via-gsclassifier.html#scaller-for-the-best-call" id="toc-scaller-for-the-best-call"><span class="toc-section-number">4.3.2</span> Scaller for the best call</a></li>
<li><a href="model-establishment-via-gsclassifier.html#assemble-your-model" id="toc-assemble-your-model"><span class="toc-section-number">4.3.3</span> Assemble your model</a></li>
<li><a href="model-establishment-via-gsclassifier.html#of-note-2" id="toc-of-note-2"><span class="toc-section-number">4.3.4</span> Of note</a></li>
</ul></li>
<li><a href="model-establishment-via-gsclassifier.html#calling-subtypes" id="toc-calling-subtypes"><span class="toc-section-number">4.4</span> Calling subtypes</a></li>
<li><a href="model-establishment-via-gsclassifier.html#topicSubmodel" id="toc-topicSubmodel"><span class="toc-section-number">4.5</span> Number of SubModel</a></li>
<li><a href="model-establishment-via-gsclassifier.html#padiPara" id="toc-padiPara"><span class="toc-section-number">4.6</span> Parameters for PADi training</a></li>
</ul></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#suggestions-for-gsclassifier-model-developers" id="toc-suggestions-for-gsclassifier-model-developers"><span class="toc-section-number">5</span> Suggestions for GSClassifier model developers</a>
<ul>
<li><a href="suggestions-for-gsclassifier-model-developers.html#about-3" id="toc-about-3"><span class="toc-section-number">5.1</span> About</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#available-models" id="toc-available-models"><span class="toc-section-number">5.2</span> Available models</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#components-of-a-gsclassifier-model" id="toc-components-of-a-gsclassifier-model"><span class="toc-section-number">5.3</span> Components of a GSClassifier model</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#submit-models-to-luckymodel-package" id="toc-submit-models-to-luckymodel-package"><span class="toc-section-number">5.4</span> Submit models to luckyModel package</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#repeatablility-of-models" id="toc-repeatablility-of-models"><span class="toc-section-number">5.5</span> Repeatablility of models</a></li>
<li><a href="suggestions-for-gsclassifier-model-developers.html#gene-annotation" id="toc-gene-annotation"><span class="toc-section-number">5.6</span> Gene Annotation</a></li>
</ul></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li><a href="https://blognas.hwb0307.com/" target="blank">Welcome to My Blog!</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Principle of R Package GSClassifier</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="discussion" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Discussion</h1>
<p>In this section, we would discuss some key topics about <strong>GSClassifier</strong>, including <strong>Missing value imputation (MVI)</strong>, <strong>Batch effect</strong>, <strong>hyperparameters</strong>, and so on.</p>
<div id="packages-1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Packages</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="discussion.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install &quot;devtools&quot; package</span></span>
<span id="cb19-2"><a href="discussion.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;devtools&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb19-3"><a href="discussion.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb19-4"><a href="discussion.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="discussion.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb19-6"><a href="discussion.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;luckyBase&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb19-7"><a href="discussion.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;huangwb8/luckyBase&quot;</span>)</span>
<span id="cb19-8"><a href="discussion.html#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="discussion.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the &quot;**GSClassifier**&quot; package</span></span>
<span id="cb19-10"><a href="discussion.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;GSClassifier&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb19-11"><a href="discussion.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;huangwb8/GSClassifier&quot;</span>)</span>
<span id="cb19-12"><a href="discussion.html#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="discussion.html#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the &quot;pacman&quot; package</span></span>
<span id="cb19-14"><a href="discussion.html#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;pacman&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb19-15"><a href="discussion.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span>
<span id="cb19-16"><a href="discussion.html#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pacman)</span>
<span id="cb19-17"><a href="discussion.html#cb19-17" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-18"><a href="discussion.html#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pacman)</span>
<span id="cb19-19"><a href="discussion.html#cb19-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-20"><a href="discussion.html#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="discussion.html#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Load needed packages</span></span>
<span id="cb19-22"><a href="discussion.html#cb19-22" aria-hidden="true" tabindex="-1"></a>packages_needed <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-23"><a href="discussion.html#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;readxl&quot;</span>,</span>
<span id="cb19-24"><a href="discussion.html#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ComplexHeatmap&quot;</span>,</span>
<span id="cb19-25"><a href="discussion.html#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;GSClassifier&quot;</span>,</span>
<span id="cb19-26"><a href="discussion.html#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rpart&quot;</span>,</span>
<span id="cb19-27"><a href="discussion.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tidyr&quot;</span>,</span>
<span id="cb19-28"><a href="discussion.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;reshape2&quot;</span>,</span>
<span id="cb19-29"><a href="discussion.html#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb19-30"><a href="discussion.html#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> packages_needed){<span class="fu">p_load</span>(<span class="at">char=</span>i)}</span></code></pre></div>
<p>Here is the environment of R programming:</p>
<pre><code># R version 4.0.3 (2020-10-10)
# Platform: x86_64-w64-mingw32/x64 (64-bit)
# Running under: Windows 10 x64 (build 18363)
# 
# Matrix products: default
# 
# locale:
# [1] LC_COLLATE=Chinese (Simplified)_China.936 
# [2] LC_CTYPE=Chinese (Simplified)_China.936   
# [3] LC_MONETARY=Chinese (Simplified)_China.936
# [4] LC_NUMERIC=C                              
# [5] LC_TIME=Chinese (Simplified)_China.936    
# 
# attached base packages:
# [1] grid      stats     graphics  grDevices utils     datasets  methods  
# [8] base     
# 
# other attached packages:
# [1] ggplot2_3.3.6        reshape2_1.4.4       tidyr_1.2.0         
# [4] rpart_4.1.16         GSClassifier_0.1.25  luckyBase_0.1.0     
# [7] ComplexHeatmap_2.4.3 readxl_1.4.0         pacman_0.5.1        
# 
# loaded via a namespace (and not attached):
#   [1] colorspace_2.0-3     ggsignif_0.6.3       rjson_0.2.21        
#   [4] ellipsis_0.3.2       class_7.3-20         rprojroot_2.0.3     
#   [7] circlize_0.4.15      GlobalOptions_0.1.2  fs_1.5.2            
#  [10] clue_0.3-57          rstudioapi_0.13      listenv_0.8.0       
#  [13] ggpubr_0.4.0         remotes_2.4.2        lubridate_1.8.0     
#  [16] prodlim_2019.11.13   fansi_1.0.3          codetools_0.2-18    
#  [19] splines_4.0.3        doParallel_1.0.17    cachem_1.0.6        
#  [22] knitr_1.30           pkgload_1.2.4        jsonlite_1.8.0      
#  [25] pROC_1.18.0          caret_6.0-92         broom_1.0.0         
#  [28] cluster_2.1.3        png_0.1-7            compiler_4.0.3      
#  [31] backports_1.4.1      assertthat_0.2.1     Matrix_1.4-1        
#  [34] fastmap_1.1.0        cli_3.3.0            htmltools_0.5.2     
#  [37] prettyunits_1.1.1    tools_4.0.3          gtable_0.3.0        
#  [40] glue_1.6.2           dplyr_1.0.9          Rcpp_1.0.8.3        
#  [43] carData_3.0-5        cellranger_1.1.0     jquerylib_0.1.4     
#  [46] vctrs_0.4.1          nlme_3.1-149         iterators_1.0.14    
#  [49] timeDate_3043.102    xfun_0.33            gower_1.0.0         
#  [52] stringr_1.4.0        globals_0.15.1       ps_1.4.0            
#  [55] testthat_3.1.0       lifecycle_1.0.1      devtools_2.4.3      
#  [58] rstatix_0.7.0        future_1.26.1        MASS_7.3-53         
#  [61] scales_1.2.0         ipred_0.9-12         parallel_4.0.3      
#  [64] RColorBrewer_1.1-3   yaml_2.3.5           memoise_2.0.1       
#  [67] sass_0.4.1           stringi_1.7.6        desc_1.4.1          
#  [70] randomForest_4.6-14  foreach_1.5.2        hardhat_1.1.0       
#  [73] pkgbuild_1.3.1       lava_1.6.10          shape_1.4.6         
#  [76] tuneR_1.4.0          rlang_1.0.2          pkgconfig_2.0.3     
#  [79] evaluate_0.15        lattice_0.20-41      purrr_0.3.4         
#  [82] recipes_0.2.0        processx_3.7.0       tidyselect_1.1.2    
#  [85] parallelly_1.32.0    plyr_1.8.7           magrittr_2.0.3      
#  [88] bookdown_0.21        R6_2.5.1             generics_0.1.2      
#  [91] DBI_1.1.3            pillar_1.7.0         withr_2.5.0         
#  [94] survival_3.3-1       abind_1.4-5          nnet_7.3-17         
#  [97] tibble_3.1.7         future.apply_1.9.0   crayon_1.5.1        
# [100] car_3.1-0            xgboost_1.6.0.1      utf8_1.2.2          
# [103] rmarkdown_2.14       GetoptLong_1.0.5     usethis_2.1.3       
# [106] data.table_1.14.2    callr_3.7.0          ModelMetrics_1.2.2.2
# [109] digest_0.6.29        stats4_4.0.3         signal_0.7-7        
# [112] munsell_0.5.0        bslib_0.3.1          sessioninfo_1.2.2</code></pre>
</div>
<div id="missing-value-imputation-mvi" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Missing value imputation (MVI)</h2>
<!--
Missing Value Imputation (MVI); 
+ Missing Value type: Missing Completely at Random (MCAR), Missing at Random (MAR), and Not Missing at Random (NMAR).
+ The main reason of missing value in the scenario of **GSClassifier**?
+ Why is missing value imputation needed in **GSClassifier** modeling?
+ Routine algorithms of missing value imputation for DNA array (mRNA expression)?
+ Missing value imputation in subtype calling?
+ The flowchart of quantile algorithm?
+ zero == Cutout; https://arxiv.org/abs/1708.04552; In this paper, we show that the simple regularization technique of randomly masking out square regions of input during training, which we call cutout, can be used to improve the robustness and overall performance of convolutional neural networks. Not only is this method extremely easy to implement, but we also demonstrate that it can be used in conjunction with existing forms of data augmentation and other regularizers to further improve model performance. We evaluate this method by applying it to current state-of-the-art architectures on the CIFAR-10, CIFAR-100, and SVHN datasets, yielding new state-of-the-art results of 2.56%, 15.20%, and 1.30% test error respectively.
+ Experiments: leave genes out of validation cohorts and then test the performance of **GSClassifier**-PADi.
-->
<p>Due to reasons like low expression/weak signal, contamination of microarray surfaces, inappropriate manual operations, insufficient resolution or systematic errors during the laboratory process <span class="citation">[<a href="references.html#ref-RN387" role="doc-biblioref">8</a>‚Äì<a href="references.html#ref-RN382" role="doc-biblioref">10</a>]</span>, <strong>missing value</strong> in high-imput genetic data is common. Generally, tiny missing value could be just dealed with case deletion, while the biological discovery might be damaged when the missing rate tops 15% <span class="citation">[<a href="references.html#ref-RN392" role="doc-biblioref">11</a>,<a href="references.html#ref-RN386" role="doc-biblioref">12</a>]</span>. Currently, lots of methods, including statistic-based or machine learning-based methods (Figure <a href="discussion.html#fig:mvi01">2.1</a>), had been developed for <strong>missing value imputation (MVI)</strong> <span class="citation">[<a href="references.html#ref-RN386" role="doc-biblioref">12</a>]</span>. Wang et al <span class="citation">[<a href="references.html#ref-RN384" role="doc-biblioref">13</a>]</span> categorized MVI methods into simple (zeros or average),biology knowledge-, global learning-, local learning-, hybrid-based methods. In order to satisfy the working conditions of xgboost <span class="citation">[<a href="references.html#ref-xgboost" role="doc-biblioref">14</a>]</span> functions (<code>xgb.train</code>, <code>xgboost</code>, and <code>xgb.cv</code>) in GSClassifer, the missing value in expression matrix must be deleted or imputation.</p>
<div class="figure" style="text-align: center"><span id="fig:mvi01"></span>
<img src="fig/mvi-01.png" alt="Missing value imputation methods reviewed by Hasan et al." width="90%" />
<p class="caption">
Figure 2.1: Missing value imputation methods reviewed by Hasan et al.
</p>
</div>
<p>In <strong>PAD</strong> project, several strategies were applied to reduce the impact of missing values as possible. First, both <strong>PIAM</strong> and <strong>PIDG</strong> in <strong>PAD</strong> project were curated GEPs that were not be missing in over 80% gastric cancer datasets. Here we showed the actual distribution of missing value across samples in gastric cancer datasets we used.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="discussion.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb21-2"><a href="discussion.html#cb21-2" aria-hidden="true" tabindex="-1"></a>testData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb21-3"><a href="discussion.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, </span>
<span id="cb21-4"><a href="discussion.html#cb21-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;testData.rds&quot;</span>, </span>
<span id="cb21-5"><a href="discussion.html#cb21-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">package =</span> <span class="st">&quot;GSClassifier&quot;</span>)</span>
<span id="cb21-6"><a href="discussion.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-7"><a href="discussion.html#cb21-7" aria-hidden="true" tabindex="-1"></a>expr_pad <span class="ot">&lt;-</span> testData<span class="sc">$</span>PanSTAD_expr_part</span>
<span id="cb21-8"><a href="discussion.html#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="discussion.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing value</span></span>
<span id="cb21-10"><a href="discussion.html#cb21-10" aria-hidden="true" tabindex="-1"></a>expr_pad_na <span class="ot">&lt;-</span> <span class="fu">apply</span>(expr_pad, <span class="dv">2</span>, </span>
<span id="cb21-11"><a href="discussion.html#cb21-11" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))<span class="sc">/</span><span class="fu">length</span>(x))</span>
<span id="cb21-12"><a href="discussion.html#cb21-12" aria-hidden="true" tabindex="-1"></a>expr_pad_na_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-13"><a href="discussion.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">names</span>(expr_pad_na),</span>
<span id="cb21-14"><a href="discussion.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">as.numeric</span>(expr_pad_na),</span>
<span id="cb21-15"><a href="discussion.html#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> F</span>
<span id="cb21-16"><a href="discussion.html#cb21-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>As shown in Figure <a href="discussion.html#fig:mvi02">2.2</a>, the percentage of all samples in gastric cancer datasets we used is lower than 8%.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="discussion.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot</span></span>
<span id="cb22-2"><a href="discussion.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> expr_pad_na_df, </span>
<span id="cb22-3"><a href="discussion.html#cb22-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> prob)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="discussion.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">color =</span> mycolor[<span class="dv">3</span>]) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="discussion.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb22-6"><a href="discussion.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Samples in gastric cancer cohorts&#39;</span>, </span>
<span id="cb22-7"><a href="discussion.html#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Percentage of missing value&#39;</span>) <span class="sc">+</span> </span>
<span id="cb22-8"><a href="discussion.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb22-9"><a href="discussion.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-10"><a href="discussion.html#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-11"><a href="discussion.html#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-12"><a href="discussion.html#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb22-13"><a href="discussion.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb22-14"><a href="discussion.html#cb22-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mvi02"></span>
<img src="Discussion_files/figure-html/mvi02-1.png" alt="The distribution of missing value across gastric cancer samples." width="80%" />
<p class="caption">
Figure 2.2: The distribution of missing value across gastric cancer samples.
</p>
</div>
<p>Second, we did conduct some MVI strategy to deal with data before model training in <strong>GSClassifier</strong>. Due to the low missing rate of our experimental data, we just <strong>set missing value as zero</strong> during model training and subtype identification in the early version of PADi (<strong>PAD.train.v20200110</strong>). The model seemed to be robust in both the internal cohort and external cohorts, and greatly predicted the response to immune checkpoint inhibitors (ICIs) in advanced gastric cancer.</p>
<p>In the new version of PADi (<strong>PAD.train.v20220917</strong>), we designed the so-called <strong>quantile</strong> algorithm for random MVI during <strong>PADi</strong> model training, which also seemed to work well for PADi model training.</p>
<!--

We supposed that ...
Add a flowchart for quantile algorithm

-->
<p>Here, we demonstrated the principle of <strong>quantile</strong> algorithm in the simulated dataset:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="discussion.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated data</span></span>
<span id="cb23-2"><a href="discussion.html#cb23-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&#39;./data/simulated-data.xlsx&#39;</span>, <span class="at">sheet =</span> <span class="st">&#39;RNA&#39;</span>)</span>
<span id="cb23-3"><a href="discussion.html#cb23-3" aria-hidden="true" tabindex="-1"></a>expr0 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb23-4"><a href="discussion.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(expr0) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.matrix</span>(x[,<span class="dv">1</span>])); <span class="fu">rm</span>(x)</span>
<span id="cb23-5"><a href="discussion.html#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="discussion.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># MVI with Quantile algorithm</span></span>
<span id="cb23-7"><a href="discussion.html#cb23-7" aria-hidden="true" tabindex="-1"></a>expr <span class="ot">&lt;-</span> expr0</span>
<span id="cb23-8"><a href="discussion.html#cb23-8" aria-hidden="true" tabindex="-1"></a>na.pos <span class="ot">&lt;-</span> <span class="fu">apply</span>(expr,<span class="dv">2</span>,is.one.na)</span>
<span id="cb23-9"><a href="discussion.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">478</span>); seeds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(expr)<span class="sc">*</span><span class="dv">10</span>, <span class="fu">sum</span>(na.pos), <span class="at">replace =</span> F)</span>
<span id="cb23-10"><a href="discussion.html#cb23-10" aria-hidden="true" tabindex="-1"></a>tSample <span class="ot">&lt;-</span> <span class="fu">names</span>(na.pos)[na.pos]</span>
<span id="cb23-11"><a href="discussion.html#cb23-11" aria-hidden="true" tabindex="-1"></a>quantile_vector <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>)<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb23-12"><a href="discussion.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tSample)){ <span class="co"># i=1</span></span>
<span id="cb23-13"><a href="discussion.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-14"><a href="discussion.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  sample.i <span class="ot">&lt;-</span> tSample[i]</span>
<span id="cb23-15"><a href="discussion.html#cb23-15" aria-hidden="true" tabindex="-1"></a>  expr.i <span class="ot">&lt;-</span> expr[, sample.i]</span>
<span id="cb23-16"><a href="discussion.html#cb23-16" aria-hidden="true" tabindex="-1"></a>  expr.i.max <span class="ot">&lt;-</span> <span class="fu">max</span>(expr.i, <span class="at">na.rm =</span> T)</span>
<span id="cb23-17"><a href="discussion.html#cb23-17" aria-hidden="true" tabindex="-1"></a>  expr.i.min <span class="ot">&lt;-</span> <span class="fu">min</span>(expr.i, <span class="at">na.rm =</span> T)</span>
<span id="cb23-18"><a href="discussion.html#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i]);</span>
<span id="cb23-19"><a href="discussion.html#cb23-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-20"><a href="discussion.html#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Details of quantile algorithm</span></span>
<span id="cb23-21"><a href="discussion.html#cb23-21" aria-hidden="true" tabindex="-1"></a>  expr.i[<span class="fu">is.na</span>(expr.i)] <span class="ot">&lt;-</span></span>
<span id="cb23-22"><a href="discussion.html#cb23-22" aria-hidden="true" tabindex="-1"></a>    expr.i.min <span class="sc">+</span></span>
<span id="cb23-23"><a href="discussion.html#cb23-23" aria-hidden="true" tabindex="-1"></a>    (expr.i.max<span class="sc">-</span>expr.i.min) <span class="sc">*</span> <span class="fu">sample</span>(quantile_vector,</span>
<span id="cb23-24"><a href="discussion.html#cb23-24" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">sum</span>(<span class="fu">is.na</span>(expr.i)),</span>
<span id="cb23-25"><a href="discussion.html#cb23-25" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">replace =</span> T)</span>
<span id="cb23-26"><a href="discussion.html#cb23-26" aria-hidden="true" tabindex="-1"></a>  expr[, sample.i] <span class="ot">&lt;-</span> expr.i</span>
<span id="cb23-27"><a href="discussion.html#cb23-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-28"><a href="discussion.html#cb23-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-29"><a href="discussion.html#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="discussion.html#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Report</span></span>
<span id="cb23-31"><a href="discussion.html#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;RNA expression:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb23-32"><a href="discussion.html#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expr0)</span>
<span id="cb23-33"><a href="discussion.html#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb23-34"><a href="discussion.html#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;RNA expression without NA value:&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb23-35"><a href="discussion.html#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expr)</span>
<span id="cb23-36"><a href="discussion.html#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA expression: </span></span>
<span id="cb23-37"><a href="discussion.html#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="co">#       Sample1 Sample2 Sample3 Sample4 Sample5 Sample6</span></span>
<span id="cb23-38"><a href="discussion.html#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene1    0.51    0.52    0.60    0.21    0.30    0.40</span></span>
<span id="cb23-39"><a href="discussion.html#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene2    0.52    0.54    0.58    0.22    0.31    0.35</span></span>
<span id="cb23-40"><a href="discussion.html#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene3    0.53    0.60    0.61      NA    0.29    0.30</span></span>
<span id="cb23-41"><a href="discussion.html#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene4    0.21    0.30    0.40    0.51    0.52    0.60</span></span>
<span id="cb23-42"><a href="discussion.html#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene5    0.22    0.31    0.35    0.52    0.54    0.58</span></span>
<span id="cb23-43"><a href="discussion.html#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene6    0.23    0.29    0.30    0.53      NA    0.61</span></span>
<span id="cb23-44"><a href="discussion.html#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene7    0.10    0.12    0.09    0.11    0.12    0.14</span></span>
<span id="cb23-45"><a href="discussion.html#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-46"><a href="discussion.html#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA expression without NA value: </span></span>
<span id="cb23-47"><a href="discussion.html#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co">#       Sample1 Sample2 Sample3 Sample4 Sample5 Sample6</span></span>
<span id="cb23-48"><a href="discussion.html#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene1    0.51    0.52    0.60 0.21000 0.30000    0.40</span></span>
<span id="cb23-49"><a href="discussion.html#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene2    0.52    0.54    0.58 0.22000 0.31000    0.35</span></span>
<span id="cb23-50"><a href="discussion.html#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene3    0.53    0.60    0.61 0.43256 0.29000    0.30</span></span>
<span id="cb23-51"><a href="discussion.html#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene4    0.21    0.30    0.40 0.51000 0.52000    0.60</span></span>
<span id="cb23-52"><a href="discussion.html#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene5    0.22    0.31    0.35 0.52000 0.54000    0.58</span></span>
<span id="cb23-53"><a href="discussion.html#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene6    0.23    0.29    0.30 0.53000 0.32622    0.61</span></span>
<span id="cb23-54"><a href="discussion.html#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene7    0.10    0.12    0.09 0.11000 0.12000    0.14</span></span></code></pre></div>
<p>Look at the new matrix via heatmap, where the clustering result is not obviously disturbed after MVI:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="discussion.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Heatmap</span>(<span class="fu">t</span>(<span class="fu">scale</span>(<span class="fu">t</span>(expr))), <span class="at">name =</span> <span class="st">&quot;Z-score&quot;</span>, <span class="at">column_title =</span> <span class="st">&quot;After MVI&quot;</span>)</span></code></pre></div>
<p><img src="Discussion_files/figure-html/unnamed-chunk-5-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Due to missing value might damage the integrity of biological information, we explored <strong>how much the number of missing value in one sample impacts subtype identification via PADi</strong>. The steps are as following: (i) we used quantile algorithm to do MVI in the internal validation cohort of gastric cancer; (ii) we randomly masked different proportion of genes as zero expression; (iii) we calculated the relative multi-ROC <span class="citation">[<a href="references.html#ref-pROC" role="doc-biblioref">15</a>]</span> (masked data vs.¬†MVI data). In <strong>GSClassifier</strong>, we developed a function called <strong>mv_tolerance</strong> to complete the task.</p>
<ol style="list-style-type: lower-roman">
<li>Load the internal validation cohort:</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="discussion.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Internal validation cohort</span></span>
<span id="cb25-2"><a href="discussion.html#cb25-2" aria-hidden="true" tabindex="-1"></a>testData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb25-3"><a href="discussion.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;testData.rds&quot;</span>, <span class="at">package =</span> <span class="st">&quot;GSClassifier&quot;</span>)</span>
<span id="cb25-4"><a href="discussion.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-5"><a href="discussion.html#cb25-5" aria-hidden="true" tabindex="-1"></a>expr_pad <span class="ot">&lt;-</span> testData<span class="sc">$</span>PanSTAD_expr_part</span>
<span id="cb25-6"><a href="discussion.html#cb25-6" aria-hidden="true" tabindex="-1"></a>modelInfo <span class="ot">&lt;-</span> <span class="fu">modelData</span>(</span>
<span id="cb25-7"><a href="discussion.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> testData<span class="sc">$</span>PanSTAD_phenotype_part,</span>
<span id="cb25-8"><a href="discussion.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">id.col =</span> <span class="st">&quot;ID&quot;</span>,</span>
<span id="cb25-9"><a href="discussion.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&quot;platform&quot;</span>, <span class="st">&quot;PAD_subtype&quot;</span>),</span>
<span id="cb25-10"><a href="discussion.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Prop =</span> <span class="fl">0.7</span>,</span>
<span id="cb25-11"><a href="discussion.html#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">19871</span></span>
<span id="cb25-12"><a href="discussion.html#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="discussion.html#cb25-13" aria-hidden="true" tabindex="-1"></a>validInform <span class="ot">&lt;-</span> modelInfo<span class="sc">$</span>Data<span class="sc">$</span>Valid</span>
<span id="cb25-14"><a href="discussion.html#cb25-14" aria-hidden="true" tabindex="-1"></a>expr_pad_innervalid <span class="ot">&lt;-</span> expr_pad[,validInform<span class="sc">$</span>ID]</span></code></pre></div>
<ol start="2" style="list-style-type: lower-roman">
<li>Missing value tolerance analysis:</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="discussion.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time-consuming</span></span>
<span id="cb26-2"><a href="discussion.html#cb26-2" aria-hidden="true" tabindex="-1"></a>mvt <span class="ot">&lt;-</span> <span class="fu">mv_tolerance</span>(</span>
<span id="cb26-3"><a href="discussion.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> expr_pad_innervalid,</span>
<span id="cb26-4"><a href="discussion.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gene.loss =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>),</span>
<span id="cb26-5"><a href="discussion.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb26-6"><a href="discussion.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">&quot;PAD.train_20220916&quot;</span>,</span>
<span id="cb26-7"><a href="discussion.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">487</span>,</span>
<span id="cb26-8"><a href="discussion.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> T</span>
<span id="cb26-9"><a href="discussion.html#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ol start="3" style="list-style-type: lower-roman">
<li>multi-ROC analysis:</li>
</ol>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="discussion.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb27-2"><a href="discussion.html#cb27-2" aria-hidden="true" tabindex="-1"></a>mvt_auc <span class="ot">&lt;-</span> mvt<span class="sc">$</span>multiAUC</span>
<span id="cb27-3"><a href="discussion.html#cb27-3" aria-hidden="true" tabindex="-1"></a>mvt_auc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb27-4"><a href="discussion.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mvt_auc)){ <span class="co"># i=1</span></span>
<span id="cb27-5"><a href="discussion.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  df.i <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-6"><a href="discussion.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">as.integer</span>(<span class="fu">Fastextra</span>(<span class="fu">names</span>(mvt_auc)[i], <span class="st">&#39;=&#39;</span>, <span class="dv">2</span>)),</span>
<span id="cb27-7"><a href="discussion.html#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">as.numeric</span>(mvt_auc[[i]]<span class="sc">$</span>auc),</span>
<span id="cb27-8"><a href="discussion.html#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> F</span>
<span id="cb27-9"><a href="discussion.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-10"><a href="discussion.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  mvt_auc_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mvt_auc_df, df.i)</span>
<span id="cb27-11"><a href="discussion.html#cb27-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-12"><a href="discussion.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="discussion.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb28-2"><a href="discussion.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mvt_auc_df, <span class="fu">aes</span>(x,y)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="discussion.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="discussion.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>)) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="discussion.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x,<span class="at">method =</span> <span class="st">&#39;glm&#39;</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="discussion.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;No. of missing value&#39;</span>, </span>
<span id="cb28-7"><a href="discussion.html#cb28-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Relative AUC in multi-ROC analysis&#39;</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="discussion.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-9"><a href="discussion.html#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb28-10"><a href="discussion.html#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb28-11"><a href="discussion.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mvi03"></span>
<img src="Discussion_files/figure-html/mvi03-1.png" alt="The association between the number of missing value and subtype identification performance." width="60%" />
<p class="caption">
Figure 2.3: The association between the number of missing value and subtype identification performance.
</p>
</div>
<p>As showed in Figure <a href="discussion.html#fig:mvi03">2.3</a>, there is linear negative correlation between the number of missing value (mising rate ranges from 6.25% to 37.5%) and subtype identification performance of <strong>PADi</strong> model. One of the reasons might be that PIAM/PIDG were small GEPs, so little gene loss might significantly impact the performance of <strong>PADi</strong>. By the way, there is no mising value in PIAM/PIDG of the ‚ÄòKim2018‚Äô cohort, an external validation cohort for ICIs therapy response prediction via <strong>PADi</strong>. Nonetheless, we still used <strong>zero strategy</strong> during subtype identification of <strong>PADi</strong> if any missing value exist, because randomization might make the result unstable, which is not suitable for clinical decision.
<!--
Nonetheless, we still used **zero strategy** during subtype identification of **PADi** if any missing value exist, because randomization might make the result unstable, which is not suitable for clinical decision. 
Moreover, we explored **if rescue of missing value would help improving the performance of PADi**. 
--></p>
<p>In conclusion, zero or quantile strategy could be applied for MVI before <strong>GSClassifier</strong> model training. However, missing value should be avoided as possible in subtype identification for missing value really damage the performance of <strong>GSClassifier</strong>. Nonetheless, due to low-input GEPs used in <strong>PADi</strong> model (No.¬†of Gene=32), it‚Äôs easy to avoid missing value in clinical practice.</p>
</div>
<div id="batch-effect" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Batch effect</h2>
<!--

gene-pair batch effect in Google Scholar

relative expression orderings (REO)

single-sample enrichment analysis 

Batch effect control & gene number

-->
<p><strong>TSP</strong> was widely applied to control batch effects in transciptomic data <span class="citation">[<a href="references.html#ref-RN369" role="doc-biblioref">16</a>‚Äì<a href="references.html#ref-RN365" role="doc-biblioref">23</a>]</span>. Still, we tested whether <strong>TSP</strong> is a robust method for batch effect control in real-world data. As demonstrated in Figure <a href="discussion.html#fig:be01">2.4</a>, the obvious batch effects across gastric cancer datsets were significantly reduced after <strong>TSP</strong> normalization.</p>
<div class="figure" style="text-align: center"><span id="fig:be01"></span>
<img src="fig/bactch-effect-01.png" alt="Batch effects across gastric cancer cohorts. All gene pairs were used because subtype vectors were not specified. Top: Raw expression of all genes across samples. Middle: Raw expression of PIAM and PIDG across samples. Bottom: TSP of PIAM and PIDG across samples." width="90%" />
<p class="caption">
Figure 2.4: Batch effects across gastric cancer cohorts. All gene pairs were used because subtype vectors were not specified. Top: Raw expression of all genes across samples. Middle: Raw expression of PIAM and PIDG across samples. Bottom: TSP of PIAM and PIDG across samples.
</p>
</div>
<p>In order to confirmed the association between <strong>gene counts</strong> in modeling and batch effect control via <strong>TSP</strong> normalization, we selected random genes with counts ranging 4, 8, 20, 40, and 80 for TSP matrix establishment. As shown in Figure <a href="discussion.html#fig:be02">2.5</a>, <strong>TSP</strong> normalization works greatly in different gene counts for batch effect control compared with raw expression matrix.</p>
<div class="figure" style="text-align: center"><span id="fig:be02"></span>
<img src="fig/bactch-effect-02.png" alt="Batch effects of random genes across gastric cancer cohorts.  All gene pairs were used because subtype vectors were not specified. Gene counts 4, 8, 20, 40, and 80 were detected. Data of set difference were not available because only one gene set were applied." width="90%" />
<p class="caption">
Figure 2.5: Batch effects of random genes across gastric cancer cohorts. All gene pairs were used because subtype vectors were not specified. Gene counts 4, 8, 20, 40, and 80 were detected. Data of set difference were not available because only one gene set were applied.
</p>
</div>
<!--
Batch effect reduction of TSP could be explained in three parts:

+ **Binned expression**. Regardless of what raw distribution of a numeric vector is, it would be converted into a binned vector with exactly the same distribution under a fixed quantile vector.

+ **Pair/set difference**.
-->
</div>
<div id="subtype-number" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Subtype number</h2>
<p>For PAD subtypes, it‚Äôs easy to determine the subtype number as 4. First, PAD subtypes are identified via 2 simple GEPs. The binary status (high/low expression) of 2 GEPs consists of a 2√ó2 matrix and hence the subtype number is exactly 4. Second, four PAD subtypes displayed different genetic/epigenetic alterations and clinical features (survival and ICI response), indicating that it‚Äôs biologically meaningful to distinguish gastric cancer into 4 immune subtypes. Third, clinicians are familiar with four subtypes, for the subtype number of the classical TNM stage in clinical oncology is 4 (Stage I to IV).</p>
<p>Also, there‚Äôs another more simple situation‚Äîdetermining the subtype number with only one GEP, where 2 (high/low) or 3 (low/moderate/high) deserve to be tried. However, with the number of GEPs increasing, the situation would become more complex. Regrettably, GSClassifier can not help determine what subtype number should be used; GSClassifier only promises a robust model no matter how many GEPs or subtypes. <strong>There‚Äôs no gold standard for subtype number selection, which is more like art instead of math</strong>.</p>
<p>Nevertheless, there‚Äôre several suggestions we can follow for best practice. First, the R package ‚Äú<strong>ConsensusClusterPlus</strong>‚Äù <span class="citation">[<a href="references.html#ref-RN421" role="doc-biblioref">24</a>‚Äì<a href="references.html#ref-RN424" role="doc-biblioref">27</a>]</span> can help figure out consensus clustering for transcriptomic data, which provides visualization (consensus matrices, consensus cumulative distribution function plot, delta area plot, tracking plot, and so on) for clustering quality control. Second, <strong>paying more attention to the biological problem usually gives extra or even crucial clues for the subtype number decision</strong>.</p>
<!--

## Hyperparameters

+ modelData(): Prop, seed

+ fitEnsembleModel():

  - n=100
  - sampSize=0.7
  - sampSeed = 2020
  - na.fill.seed = 443
  - breakVec=c(0, 0.25, 0.5, 0.75, 1.0)
  - ptail=0.8/2
  
  - https://www.youtube.com/watch?v=f3ryHJ05h5k
  
  - https://xgboost.readthedocs.io/en/latest/parameter.html
  - Parameters for Tree Booster
  - params = list(max_depth = 10,
                  eta = 0.5,
                  nrounds = 100,
                  nthread = 10,
                  nfold=5)
                  
  ÊâÄ‰ª•ÔºåÂú®Êó∂Èó¥ÈùûÂ∏∏ÂÆùË¥µÁöÑÊÉÖÂÜµ‰∏ãÔºå‰Ω†ÂøÖÈ°ªÂ∫îÁî®Ëá™ Â∑±ÁöÑÂà§Êñ≠ÂäõÔºåÂπ∂‰ΩøÁî®Â∞èÊï∞ÊçÆÊ†∑Êú¨Êù•ÊâæÂá∫ÂêàÈÄÇÁöÑË∞É‰ºòÂèÇÊï∞ÔºåÂê¶ÂàôÁ°¨ÁõòÁ©∫Èó¥ÂèØËÉΩ‰∏çË∂≥
  nrounds ÔºöÊúÄÂ§ßËø≠‰ª£Ê¨°Êï∞ÔºàÊúÄÁªàÊ®°Âûã‰∏≠Ê†ëÁöÑÊï∞ÈáèÔºâ„ÄÇ
  colsample_bytree ÔºöÂª∫Á´ãÊ†ëÊó∂ÈöèÊú∫ÊäΩÂèñÁöÑÁâπÂæÅÊï∞ÈáèÔºåÁî®‰∏Ä‰∏™ÊØîÁéáË°®Á§∫ÔºåÈªòËÆ§ÂÄº‰∏∫1Ôºà‰Ωø
Áî®100%ÁöÑÁâπÂæÅÔºâ„ÄÇ
  min_child_weight ÔºöÂØπÊ†ëËøõË°åÊèêÂçáÊó∂‰ΩøÁî®ÁöÑÊúÄÂ∞èÊùÉÈáçÔºåÈªòËÆ§‰∏∫1„ÄÇ
  eta ÔºöÂ≠¶‰π†ÁéáÔºåÊØèÊ£µÊ†ëÂú®ÊúÄÁªàËß£‰∏≠ÁöÑË¥°ÁåÆÔºåÈªòËÆ§‰∏∫0.3„ÄÇ
  gamma ÔºöÂú®Ê†ë‰∏≠Êñ∞Â¢û‰∏Ä‰∏™Âè∂Â≠êÂàÜÂå∫Êó∂ÊâÄÈúÄÁöÑÊúÄÂ∞èÂáèÊçü„ÄÇ
  subsample ÔºöÂ≠êÊ†∑Êú¨Êï∞ÊçÆÂç†Êï¥‰∏™ËßÇÊµãÁöÑÊØî‰æãÔºåÈªòËÆ§ÂÄº‰∏∫1Ôºà100%Ôºâ„ÄÇ
  max_depth ÔºöÂçï‰∏™Ê†ëÁöÑÊúÄÂ§ßÊ∑±Â∫¶„ÄÇ
-->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-principle-of-gsclassifier.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quick-start.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GSClassifier.principle.pdf", "GSClassifier.principle.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
